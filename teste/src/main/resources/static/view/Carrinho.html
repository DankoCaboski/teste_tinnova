<!DOCTYPE html>
<html>
<head>
    <title>Carrinho</title>
</head>
<body>
    <h1>Produtos no meu carrinho</h1>

    <div id="cart-items">
        <ul id="item-list"></ul>
    </div>

    <div id="total-price">
        Total: R$ <span id="total-price-value">0.00</span>
    </div>

    <button id="discount-button">Aplicar desconto (5%)</button>
    
    <script>
        fetch('http://localhost:8080/carrinho')
            .then(response => response.json())
            .then(data => {
                const itemList = document.getElementById('item-list');
                const totalPriceSpan = document.getElementById('total-price-value');
                let totalPrice = 0;
    
                data.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `${item.name} - R$ ${item.price.toFixed(2)}`;
                    itemList.appendChild(li); // Adiciona o item à lista de itens
                    
                    totalPrice += item.price; // Soma o preço do item ao total
                });
    
                totalPriceSpan.textContent = totalPrice.toFixed(2); // Atualiza o total exibido
            })
            .catch(error => console.error('Error:', error));

        let vezes = 0;
        document.getElementById('discount-button').addEventListener('click', () => {
            if (vezes == 0) {
                const totalPriceSpan = document.getElementById('total-price-value');
                let totalPrice = parseFloat(totalPriceSpan.textContent);
                
                // Calculate the discount
                const discount = totalPrice * 0.05;
                totalPrice -= discount;
                
                // Update the total price
                totalPriceSpan.textContent = totalPrice.toFixed(2);
            }
            vezes++;
        });
    </script>
    
</body>
</html>
